function Attribute(args,arg2){var splitTypes;if(!1==this instanceof Attribute)throw new Error("new operator required");if("string"==typeof args){var quickName=args;args={},args.name=quickName,"string"==typeof arg2&&(args.type=arg2)}args=args||{},this.name=args.name||null,this.label=args.label||args.name,this.label&&(this.label=this.label.charAt(0).toUpperCase()+this.label.slice(1)),this.type=args.type||"String",splitTypes=function(str){var tmpSplit=str.split("(");return tmpSplit[1]=parseInt(tmpSplit[1]),tmpSplit}(this.type),this.type=splitTypes[0],this.hint=args.hint||{},this.validationRule=args.validationRule||{};var unusedProperties=[],standardProperties=["name","type","label","hint","value","validationRule"];switch(this.type){case"ID":unusedProperties=T.getInvalidProperties(args,standardProperties),this.value=args.value||null;break;case"String":unusedProperties=T.getInvalidProperties(args,standardProperties.concat(["placeHolder","quickPick","size"])),this.size=splitTypes[1]?splitTypes[1]:"number"==typeof args.size?args.size:args.size||50,this.value=args.value||null,args.quickPick&&(this.quickPick=args.quickPick),this.placeHolder=args.placeHolder||null;break;case"Date":unusedProperties=T.getInvalidProperties(args,standardProperties.concat("placeHolder")),this.value=args.value||null,this.placeHolder=args.placeHolder||null;break;case"Boolean":unusedProperties=T.getInvalidProperties(args,standardProperties),this.value=args.value===!1?!1:args.value||null;break;case"Number":unusedProperties=T.getInvalidProperties(args,standardProperties.concat("placeHolder")),this.value=0===args.value?0:args.value||null,this.placeHolder=args.placeHolder||null;break;case"Model":unusedProperties=T.getInvalidProperties(args,standardProperties),this.value=args.value||null,this.value instanceof Attribute.ModelID&&(this.modelType=this.value.modelType);break;case"Group":unusedProperties=T.getInvalidProperties(args,standardProperties),this.value=args.value||null;break;case"Table":unusedProperties=T.getInvalidProperties(args,standardProperties.concat("group")),this.value=args.value||null,this.group=args.group||null;break;case"Object":unusedProperties=T.getInvalidProperties(args,standardProperties),this.value=args.value||null}for(var errorList=this.getObjectStateErrors(),i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Attribute: multiple errors");if(errorList.length)throw new Error("error creating Attribute: "+errorList[0]);this._eventListeners=[],this._errorConditions={}}function Command(args){if(!1==this instanceof Command)throw new Error("new operator required");if("function"==typeof args){var theFunc=args;args={type:"Function",contents:theFunc}}args=args||{};var i,unusedProperties=T.getInvalidProperties(args,["name","description","type","contents","scope","timeout","theme","icon","bucket"]),errorList=[];for(i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Command: multiple errors");if(errorList.length)throw new Error("error creating Command: "+errorList[0]);for(i in args)this[i]=args[i];if(this.name=this.name||"(unnamed)","string"!=typeof this.name)throw new Error("name must be string");if("undefined"==typeof this.description&&(this.description=this.name+" Command"),"undefined"==typeof this.type&&(this.type="Stub"),!T.contains(T.getCommandTypes(),this.type))throw new Error("Invalid command type: "+this.type);switch(this.type){case"Stub":break;case"Menu":if(!(this.contents instanceof Array))throw new Error("contents must be array of menu items");if(!this.contents.length)throw new Error("contents must be array of menu items");for(i in this.contents)if(this.contents.hasOwnProperty(i)&&"string"!=typeof this.contents[i]&&!(this.contents[i]instanceof Command))throw new Error("contents must be array of menu items");break;case"Presentation":if(!(this.contents instanceof Presentation))throw new Error("contents must be a Presentation");break;case"Function":if("function"!=typeof this.contents)throw new Error("contents must be a Function");break;case"Procedure":if(!(this.contents instanceof Procedure))throw new Error("contents must be a Procedure")}if("undefined"!=typeof this.scope&&!(this.scope instanceof Model||this.scope instanceof List))throw new Error("optional scope property must be Model or List");if("undefined"!=typeof this.timeout&&"Number"!=typeof this.timeout)throw new Error("timeout must be a Number");if("undefined"!=typeof this.timeout&&"Number"!=typeof this.timeout)throw new Error("timeout must be a Number");if("undefined"!=typeof this.theme){if("string"!=typeof this.theme)throw new Error("invalid theme");if(!T.contains(["default","primary","success","info","warning","danger","link"],this.theme))throw new Error("invalid theme")}if("undefined"!=typeof this.icon){if("string"!=typeof this.icon)throw new Error("invalid icon");if(!T.contains(["fa","glyphicon"],this.icon.split("-")[0])||!this.icon.split("-")[1])throw new Error("invalid icon")}this._eventListeners=[]}function Delta(modelID){if(!1==this instanceof Delta)throw new Error("new operator required");if(!1==modelID instanceof Attribute.ModelID)throw new Error("Attribute.ModelID required in constructor");this.dateCreated=new Date,this.modelID=modelID,this.attributeValues={}}function Interface(args){if(!1==this instanceof Interface)throw new Error("new operator required");args=args||{},args.name=args.name||"(unnamed)",args.description=args.description||"a Interface";var i,unusedProperties=T.getInvalidProperties(args,["name","description"]),errorList=[];for(i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Procedure: multiple errors");if(errorList.length)throw new Error("error creating Procedure: "+errorList[0]);this.startCallback=null,this.stopCallback=null,this.mocks=[],this.mockPending=!1;for(i in args)this[i]=args[i]}function Message(type,contents){if(!1==this instanceof Message)throw new Error("new operator required");if("undefined"==typeof type)throw new Error("message type required");if(!T.contains(T.getMessageTypes(),type))throw new Error("Invalid message type: "+type);this.type=type,this.contents=contents}function Request(args){if(!1==this instanceof Request)throw new Error("new operator required");if("string"==typeof args){var quickType=args;args={},args.type=quickType}if(args=args||{},this.type=args.type||null,!this.type||"string"!=typeof this.type)throw new Error("Request type required");switch(this.type){case"Command":if(this.command=args.command||null,!1==this.command instanceof Command)throw new Error("command object required")}}function Transport(location,callBack){if(!1==this instanceof Transport)throw new Error("new operator required");if("string"!=typeof location)throw new Error("argument must a url string");if("function"!=typeof callBack)throw new Error("argument must a callback");var self=this;self.connected=!1,self.initialConnect=!0,self.location=location,""==self.location&&(self.location="http host"),self.socket=io.connect(location),self.socket.on("connect",function(){self.connected=!0,self.initialConnect=!1,console.log("socket.io ("+self.location+") connected"),callBack.call(self,new Message("Connected",""))}),self.socket.on("connecting",function(){console.log("socket.io ("+self.location+") connecting")}),self.socket.on("error",function(reason){var theReason=reason;theReason.length<1&&(theReason="(unknown)"),console.error("socket.io ("+self.location+") error: "+theReason+"."),self.initialConnect&&callBack.call(self,new Message("Error","cannot connect"))}),self.socket.on("connect_failed",function(reason){var theReason=reason;theReason.length<1&&(theReason="(unknown)"),console.error("socket.io ("+self.location+") connect_failed: "+theReason+"."),self.initialConnect&&callBack.call(self,new Message("Error","cannot connect"))}),self.socket.on("message",function(obj){console.log("socket.io ("+self.location+") message: "+obj)}),self.socket.on("disconnect",function(reason){self.connected=!1,console.log("socket.io ("+self.location+") disconnect: "+reason)})}function Workspace(args){if(!1==this instanceof Workspace)throw new Error("new operator required");args=args||{},args.attributes||(args.attributes=[]);var userModelID=new Attribute.ModelID(new User);args.attributes.push(new Attribute({name:"user",type:"Model",value:userModelID})),args.attributes.push(new Attribute({name:"deltas",type:"Object",value:{}})),Model.call(this,args),this.modelType="Workspace"}function Bootstrap3PanelInterface(args){if(!1==this instanceof Bootstrap3PanelInterface)throw new Error("new operator required");args=args||{},args.name=args.name||"(unnamed)",args.description=args.description||"a Interface";var i,unusedProperties=T.getInvalidProperties(args,["name","description"]),errorList=[];for(i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Procedure: multiple errors");if(errorList.length)throw new Error("error creating Procedure: "+errorList[0]);this.startCallback=null,this.stopCallback=null,this.mocks=[],this.mockPending=!1;for(i in args)this[i]=args[i]}function Framework7Interface(args){if(!1==this instanceof Framework7Interface)throw new Error("new operator required");args=args||{},args.name=args.name||"(unnamed)",args.description=args.description||"a Interface";var i,unusedProperties=T.getInvalidProperties(args,["name","description"]),errorList=[];for(i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Procedure: multiple errors");if(errorList.length)throw new Error("error creating Procedure: "+errorList[0]);this.startCallback=null,this.stopCallback=null,this.mocks=[],this.mockPending=!1;for(i in args)this[i]=args[i]}function MockInterface(args){if(!1==this instanceof MockInterface)throw new Error("new operator required");args=args||{},args.name=args.name||"(unnamed)",args.description=args.description||"a Interface";var i,unusedProperties=T.getInvalidProperties(args,["name","description"]),errorList=[];for(i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Procedure: multiple errors");if(errorList.length)throw new Error("error creating Procedure: "+errorList[0]);this.startCallback=null,this.stopCallback=null,this.mocks=[],this.mockPending=!1;for(i in args)this[i]=args[i]}var Tequila=function(){function init(){var version="0.1.5",attributeTypes=["ID","String","Date","Boolean","Number","Model","Group","Table","Object"],AttributeEvents=["StateChange","Validate"],ModelEvents=["StateChange","Validate"],messageTypes=["Null","Connected","Error","Sent","Ping","PutModel","PutModelAck","GetModel","GetModelAck","DeleteModel","DeleteModelAck","GetList","GetListAck"],commandTypes=["Stub","Menu","Presentation","Function","Procedure"],commandEvents=["BeforeExecute","AfterExecute","Error","Aborted","Completed"],logTypes=["Text","Delta"],messageHandlers={};return{getVersion:function(){return version},isServer:function(){return"undefined"!=typeof exports&&this.exports!==exports},contains:function(a,obj){for(var i=0;i<a.length;i++)if(a[i]===obj)return!0;return!1},getInvalidProperties:function(args,allowedProperties){var props=[];for(var property in args)args.hasOwnProperty(property)&&(this.contains(allowedProperties,property)||props.push(property));return props},inheritPrototype:function(p){function f(){}if(null==p)throw TypeError();if(Object.create)return Object.create(p);var t=typeof p;if("object"!==t&&"function"!=typeof t)throw TypeError();return f.prototype=p,new f},getAttributeTypes:function(){return attributeTypes.slice(0)},getAttributeEvents:function(){return AttributeEvents.slice(0)},getModelEvents:function(){return ModelEvents.slice(0)},getMessageTypes:function(){return messageTypes.slice(0)},getCommandTypes:function(){return commandTypes.slice(0)},getCommandEvents:function(){return commandEvents.slice(0)},getLogTypes:function(){return logTypes.slice(0)},setMessageHandler:function(message,handler){messageHandlers[message]=handler},hostMessageProcess:function(obj,fn){messageHandlers[obj.type]?messageHandlers[obj.type](obj.contents,fn):fn(!0)}}}var singletonInstance;return function(){return singletonInstance||(singletonInstance=init()),singletonInstance}}(),T=Tequila();Attribute.ModelID=function(model){if(!1==this instanceof Attribute.ModelID)throw new Error("new operator required");if(!1==model instanceof Model)throw new Error("must be constructed with Model");this.value=model.get("id"),this.constructorFunction=model.constructor,this.modelType=model.modelType},Attribute.ModelID.prototype.toString=function(){return"string"==typeof this.value?"ModelID("+this.modelType+":'"+this.value+"')":"ModelID("+this.modelType+":"+this.value+")"},Attribute.prototype.toString=function(){return null===this.name?"new Attribute":"Attribute: "+this.name},Attribute.prototype.onEvent=function(events,callback){if(!(events instanceof Array)){if("string"!=typeof events)throw new Error("subscription string or array required");events=[events]}if("function"!=typeof callback)throw new Error("callback is required");for(var i in events)if(events.hasOwnProperty(i)&&"*"!=events[i]&&!T.contains(T.getAttributeEvents(),events[i]))throw new Error("Unknown command event: "+events[i]);return this._eventListeners.push({events:events,callback:callback}),this},Attribute.prototype._emitEvent=function(event){var i;for(i in this._eventListeners)if(this._eventListeners.hasOwnProperty(i)){var subscriber=this._eventListeners[i];(subscriber.events.length&&"*"===subscriber.events[0]||T.contains(subscriber.events,event))&&subscriber.callback.call(this,event)}},Attribute.prototype.coerce=function(value){var temp,newValue=value;switch(this.type){case"String":return"undefined"==typeof newValue?"":"boolean"!=typeof newValue||newValue?newValue?(newValue=value.toString(),newValue.length>this.size?newValue.substring(0,this.size):newValue):"":"false";case"Number":return"undefined"==typeof newValue?0:newValue?("string"==typeof newValue?(newValue=newValue.replace(/^\s+|\s+$/g,""),temp=newValue.split(" "),newValue=temp.length?temp[0]:"",newValue=Number(newValue.replace(/[^/0-9\ \.]+/g,""))):newValue=Number(newValue),newValue?newValue:0):0;case"Boolean":return"undefined"==typeof newValue?!1:"string"==typeof newValue?(newValue=newValue.toUpperCase(),"Y"===newValue||"YES"===newValue||"T"===newValue||"TRUE"===newValue||"1"===newValue?!0:!1):1==newValue;case"Date":return"string"==typeof newValue&&2==newValue.split("/").length&&(newValue=newValue+"/"+(new Date).getFullYear()),new Date(newValue)}throw Error("coerce cannot determine appropriate value")},Attribute.prototype.getObjectStateErrors=function(){switch(this.validationErrors=[],this.name||this.validationErrors.push("name required"),T.contains(T.getAttributeTypes(),this.type)||this.validationErrors.push("Invalid type: "+this.type),this.type){case"ID":break;case"String":"number"!=typeof this.size&&this.validationErrors.push("size must be a number from 1 to 255"),(this.size<1||this.size>255)&&this.validationErrors.push("size must be a number from 1 to 255"),null!=this.value&&"string"!=typeof this.value&&this.validationErrors.push("value must be null or a String");break;case"Date":null==this.value||this.value instanceof Date||this.validationErrors.push("value must be null or a Date");break;case"Boolean":null!=this.value&&"boolean"!=typeof this.value&&this.validationErrors.push("value must be null or a Boolean");break;case"Number":null!=this.value&&"number"!=typeof this.value&&this.validationErrors.push("value must be null or a Number");break;case"Model":this.value instanceof Attribute.ModelID||this.validationErrors.push("value must be Attribute.ModelID");break;case"Group":if(null==this.value||this.value instanceof Array)for(var i in this.value)this.value.hasOwnProperty(i)&&(this.value[i]instanceof Attribute||this.validationErrors.push("each element in group must be instance of Attribute"),this.value[i].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("value must be null or an array");break;case"Table":if(this.group instanceof Attribute)if(this.group.value instanceof Array)if(this.group.value.length<1)this.validationErrors.push("group property value must contain at least one Attribute");else for(var i in this.group.value)this.group.value.hasOwnProperty(i)&&(this.group.value[i]instanceof Attribute||this.validationErrors.push("each element in group must be instance of Attribute"),this.group.value[i].getObjectStateErrors().length&&this.validationErrors.push("group contains invalid members"));else this.validationErrors.push("group.value must be an array");else this.validationErrors.push("group property required")}var validationRuleBadProps=T.getInvalidProperties(this.validationRule,["required","range","isOneOf","isValidModel"]);return validationRuleBadProps.length&&this.validationErrors.push("invalid validationRule: "+validationRuleBadProps),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},Attribute.prototype.validate=function(callBack){if("function"!=typeof callBack)throw new Error("callback is required");this.getObjectStateErrors(),this._emitEvent("Validate");var e;for(e in this._errorConditions)this._errorConditions.hasOwnProperty(e)&&this.validationErrors.push(this._errorConditions[e]);this.validationRule.required&&!this.value&&("Number"==this.type?0!==this.value&&this.validationErrors.push(this.label+" required"):"Boolean"==this.type?this.value!==!1&&this.validationErrors.push(this.label+" required"):this.validationErrors.push(this.label+" required")),this.validationRule.range&&(this.validationRule.range instanceof Array||(this.validationRule.range=[this.validationRule.range]),(this.validationRule.range[0]||0===this.validationRule.range[0])&&this.value<this.validationRule.range[0]&&this.validationErrors.push(this.label+" must be at least "+this.validationRule.range[0]),(this.validationRule.range[1]||0===this.validationRule.range[1])&&this.value>this.validationRule.range[1]&&this.validationErrors.push(this.label+" must be no more than "+this.validationRule.range[1])),this.validationRule.isOneOf&&(this.validationRule.isOneOf instanceof Array||(this.validationRule.isOneOf=[this.validationRule.isOneOf]),-1==this.validationRule.isOneOf.indexOf(this.value)&&this.validationErrors.push(this.label+" invalid")),this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this._emitEvent("StateChange"),callBack.call(this)},Attribute.prototype.setError=function(condition,description){if(condition=condition||"",description=description||"",!condition)throw new Error("condition required");if(!description)throw new Error("description required");this._errorConditions[condition]=description},Attribute.prototype.clearError=function(condition){if(condition=condition||"",!condition)throw new Error("condition required");delete this._errorConditions[condition]},Command.prototype.toString=function(){return this.type+" Command: "+this.name},Command.prototype.onEvent=function(events,callback){if(!(events instanceof Array)){if("string"!=typeof events)throw new Error("subscription string or array required");events=[events]}if("function"!=typeof callback)throw new Error("callback is required");for(var i in events)if(events.hasOwnProperty(i)&&"*"!=events[i]&&!T.contains(T.getCommandEvents(),events[i]))throw new Error("Unknown command event: "+events[i]);this._eventListeners.push({events:events,callback:callback})},Command.prototype._emitEvent=function(event){var i;for(i in this._eventListeners)if(this._eventListeners.hasOwnProperty(i)){var subscriber=this._eventListeners[i];(subscriber.events.length&&"*"===subscriber.events[0]||T.contains(subscriber.events,event))&&subscriber.callback.call(this,event)}"Completed"==event&&(this._eventListeners=[])},Command.prototype.execute=function(){function callFunc(){try{self.contents.apply(self,args)}catch(e){self.error=e,self._emitEvent("Error"),self._emitEvent("Completed"),self.status=-1}}function ProcedureExecute(){self.status=0;for(var tasks=self.contents.tasks||[],t=0;t<tasks.length;t++){if("function"==typeof tasks[t]){var theFunc=tasks[t];tasks[t]={requires:[-1],command:new Command({type:"Function",contents:theFunc})}}tasks[t].command._parentProcedure||(tasks[t].command._taskIndex=t,tasks[t].command._parentProcedure=self,tasks[t].command.onEvent("*",ProcedureEvents));var canExecute=!0;if("undefined"==typeof tasks[t].command.status){for(var r in tasks[t].requires){if("string"==typeof tasks[t].requires[r])for(var l=0;l<tasks.length;l++)tasks[l].label==tasks[t].requires[r]&&(!tasks[l].command.status||tasks[l].command.status<=0)&&(canExecute=!1);if("number"==typeof tasks[t].requires[r])if(-1==tasks[t].requires[r])"0"!=t&&(!tasks[t-1].command.status||tasks[t-1].command.status<=0)&&(canExecute=!1);else{var rq=tasks[t].requires[r];(!tasks[rq].command.status||tasks[rq].command.status<=0)&&(canExecute=!1)}}canExecute&&tasks[t].command.execute()}}}function ProcedureEvents(event){var tasks=self.contents.tasks,allTasksDone=!0;switch(event){case"Error":self._emitEvent("Error");break;case"Completed":for(var t in tasks)tasks.hasOwnProperty(t)&&(tasks[t].command.status&&0!=tasks[t].command.status||(allTasksDone=!1));allTasksDone?self.complete():ProcedureExecute()}}if(!this.type)throw new Error("command not implemented");if(!T.contains(["Function","Procedure","Presentation"],this.type))throw new Error("command type "+this.type+" not implemented");var errors;switch(this.type){case"Presentation":if(!(this.contents instanceof Presentation))throw new Error("contents must be a Presentation");if(errors=this.contents.getObjectStateErrors(),errors.length)throw new Error(errors.length>1?"error executing Presentation: multiple errors":"error executing Presentation: "+errors[0])}var self=this,args=arguments;this._emitEvent("BeforeExecute");try{switch(this.type){case"Function":this.status=0,setTimeout(callFunc,0);break;case"Procedure":setTimeout(ProcedureExecute,0)}}catch(e){this.error=e,this._emitEvent("Error"),this._emitEvent("Completed"),this.status=-1}this._emitEvent("AfterExecute")},Command.prototype.abort=function(){this._emitEvent("Aborted"),this.status=-1,this._emitEvent("Completed")},Command.prototype.complete=function(){this.status=1,this._emitEvent("Completed")},Interface.prototype.toString=function(){return this.description},Interface.prototype.canMock=function(){return!1},Interface.prototype.doMock=function(){if(this.mockPending=!1,!(this.mocks.length<1)){var thisMock=this.mocks.shift();this.dispatch(thisMock),this.mockPending=!0;var self=this;setTimeout(function(){self.doMock()},0)}},Interface.prototype.mockRequest=function(args){if(!(args instanceof Array||args instanceof Request))throw new Error("missing request parameter");args instanceof Array||(args=[args]);var i;for(i=0;i<args.length;i++)if(!1==args[i]instanceof Request)throw new Error("invalid request parameter");for(i=0;i<args.length;i++)this.mocks.push(args[i]);this.mockPending||this.doMock()},Interface.prototype.start=function(application,presentation,callBack){if(!(application instanceof Application))throw new Error("Application required");if(!(presentation instanceof Presentation))throw new Error("presentation required");if("function"!=typeof callBack)throw new Error("callBack required");this.application=application,this.presentation=presentation,this.startCallback=callBack},Interface.prototype.stop=function(callBack){if("function"!=typeof callBack)throw new Error("callBack required")},Interface.prototype.dispatch=function(request,response){if(!1==request instanceof Request)throw new Error("Request required");if(response&&"function"!=typeof response)throw new Error("response callback is not a function");this.application&&this.application.dispatch(request)||this.startCallback&&this.startCallback(request)},Interface.prototype.notify=function(request){if(!1==request instanceof Request)throw new Error("Request required")},Interface.prototype.render=function(presentation,callBack){if(!1==presentation instanceof Presentation)throw new Error("Presentation object required");if(callBack&&"function"!=typeof callBack)throw new Error("optional second argument must a commandRequest callback function")};var List=function(model){if(!1==this instanceof List)throw new Error("new operator required");if(!1==model instanceof Model)throw new Error("argument required: model");this.model=model,this._items=[],this._itemIndex=-1};List.prototype.length=function(){return this._items.length},List.prototype.clear=function(){return this._items=[],this._itemIndex=-1,this},List.prototype.get=function(attribute){if(this._items.length<1)throw new Error("list is empty");for(var i=0;i<this.model.attributes.length;i++)if(this.model.attributes[i].name.toUpperCase()==attribute.toUpperCase())return this._items[this._itemIndex][i]},List.prototype.set=function(attribute,value){if(this._items.length<1)throw new Error("list is empty");for(var i=0;i<this.model.attributes.length;i++)if(this.model.attributes[i].name.toUpperCase()==attribute.toUpperCase())return void(this._items[this._itemIndex][i]=value);throw new Error("attribute not valid for list model")},List.prototype.addItem=function(item){var values=[];if(item)for(var i in item.attributes)values.push(item.attributes[i].value);else for(var i in this.model.attributes)values.push(void 0);return this._items.push(values),this._itemIndex=this._items.length-1,this},List.prototype.removeItem=function(){return this._items.splice(this._itemIndex,1),this._itemIndex--,this},List.prototype.indexedItem=function(index){return this._items.length<1?!1:0>index?!1:index>=this._items.length?!1:(this._itemIndex=index,!0)},List.prototype.moveNext=function(){return this._items.length<1?!1:this.indexedItem(this._itemIndex+1)},List.prototype.movePrevious=function(){return this._items.length<1?!1:this.indexedItem(this._itemIndex-1)},List.prototype.moveFirst=function(){return this._items.length<1?!1:this.indexedItem(0)},List.prototype.moveLast=function(){return this._items.length<1?!1:this.indexedItem(this._items.length-1)},List.prototype.sort=function(key){var keyvalue,i=0;for(var keyName in key)keyvalue||(keyvalue=keyName);if(!keyvalue)throw new Error("sort order required");for(var ascendingSort=1==key[keyvalue];i<this.model.attributes.length&&this.model.attributes[i].name!=keyvalue;)i++;this._items.sort(function(a,b){if(ascendingSort){if(a[i]<b[i])return-1;if(a[i]>b[i])return 1}else{if(a[i]>b[i])return-1;if(a[i]<b[i])return 1}return 0})},Message.prototype.toString=function(){switch(this.type){case"Null":return this.type+" Message";default:return this.type+" Message: "+this.contents}};var Model=function(args){if(!1==this instanceof Model)throw new Error("new operator required");if(this.modelType="Model",this.attributes=[new Attribute("id","ID")],args=args||{},args.attributes)for(var i in args.attributes)args.attributes.hasOwnProperty(i)&&this.attributes.push(args.attributes[i]);for(var unusedProperties=T.getInvalidProperties(args,["attributes"]),errorList=this.getObjectStateErrors(),i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Model: multiple errors");if(errorList.length)throw new Error("error creating Model: "+errorList[0]);this._eventListeners=[],this._errorConditions={}};Model.prototype.toString=function(){return"a "+this.modelType},Model.prototype.copy=function(sourceModel){for(var i=0;i<this.attributes.length;i++)this.attributes[i].value=sourceModel.attributes[i].value},Model.prototype.getObjectStateErrors=function(){if(this.validationErrors=[],this.attributes instanceof Array)if(this.attributes.length<1)this.validationErrors.push("attributes must not be empty");else for(var i=0;i<this.attributes.length;i++)0!=i||this.attributes[i]instanceof Attribute&&"ID"==this.attributes[i].type||this.validationErrors.push("first attribute must be ID"),this.attributes[i]instanceof Attribute||this.validationErrors.push("attribute must be Attribute");else this.validationErrors.push("attributes must be Array");return void 0===this.tags||this.tags instanceof Array||this.validationErrors.push("tags must be Array or null"),this.validationErrors},Model.prototype.get=function(attribute){for(var i=0;i<this.attributes.length;i++)if(this.attributes[i].name.toUpperCase()==attribute.toUpperCase())return this.attributes[i].value},Model.prototype.getAttributeType=function(attribute){for(var i=0;i<this.attributes.length;i++)if(this.attributes[i].name.toUpperCase()==attribute.toUpperCase())return this.attributes[i].type},Model.prototype.set=function(attribute,value){for(var i=0;i<this.attributes.length;i++)if(this.attributes[i].name.toUpperCase()==attribute.toUpperCase())return void(this.attributes[i].value=value);throw new Error("attribute not valid for model")},Model.prototype.validate=function(callBack){var i,e,model=this,validationsPending=0;if("function"!=typeof callBack)throw new Error("callback is required");model.getObjectStateErrors();for(e in model._errorConditions)model._errorConditions.hasOwnProperty(e)&&model.validationErrors.push(model._errorConditions[e]);if(model.validationErrors.length)return model.validationMessage=model.validationErrors.length>0?model.validationErrors[0]:"",model._emitEvent("StateChange"),void callBack.call(model);for(i=0;i<model.attributes.length;i++)validationsPending++,function(curAttribute){setTimeout(function(){curAttribute.validate(function(){curAttribute.validationErrors.length&&model.validationErrors.push("bush"),0==--validationsPending&&(model.validationErrors.length||model._emitEvent("Validate"),model.validationMessage=model.validationErrors.length>0?model.validationErrors[0]:"",model._emitEvent("StateChange"),callBack.call(model))})},0)}(model.attributes[i])},Model.prototype.onEvent=function(events,callback){if(!(events instanceof Array)){if("string"!=typeof events)throw new Error("subscription string or array required");events=[events]}if("function"!=typeof callback)throw new Error("callback is required");for(var i in events)if(events.hasOwnProperty(i)&&"*"!=events[i]&&!T.contains(T.getModelEvents(),events[i]))throw new Error("Unknown command event: "+events[i]);return this._eventListeners.push({events:events,callback:callback}),this},Model.prototype._emitEvent=function(event){var i;for(i in this._eventListeners)if(this._eventListeners.hasOwnProperty(i)){var subscriber=this._eventListeners[i];(subscriber.events.length&&"*"===subscriber.events[0]||T.contains(subscriber.events,event))&&subscriber.callback.call(this,event)}},Model.prototype.setError=function(condition,description){if(condition=condition||"",description=description||"",!condition)throw new Error("condition required");if(!description)throw new Error("description required");this._errorConditions[condition]=description},Model.prototype.clearError=function(condition){if(condition=condition||"",!condition)throw new Error("condition required");delete this._errorConditions[condition]};var Procedure=function(args){if(!1==this instanceof Procedure)throw new Error("new operator required");args=args||{};var i,unusedProperties=T.getInvalidProperties(args,["tasks","tasksNeeded","tasksCompleted"]),errorList=[];for(i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Procedure: multiple errors");if(errorList.length)throw new Error("error creating Procedure: "+errorList[0]);for(i in args)args.hasOwnProperty(i)&&(this[i]=args[i]);if(errorList=this.getObjectStateErrors()){if(errorList.length>1)throw new Error("error creating Procedure: multiple errors");
if(errorList.length)throw new Error("error creating Procedure: "+errorList[0])}};Procedure.prototype.getObjectStateErrors=function(){var i,j,k,unusedProperties;if(this.tasks&&!(this.tasks instanceof Array))return["tasks is not an array"];var errorList=[];for(i in this.tasks)if(this.tasks.hasOwnProperty(i)){var task=this.tasks[i];for(unusedProperties=T.getInvalidProperties(task,["label","command","requires","timeout"]),j=0;j<unusedProperties.length;j++)errorList.push("invalid task["+i+"] property: "+unusedProperties[j]);"undefined"!=typeof task.label&&"string"!=typeof task.label&&errorList.push("task["+i+"].label must be string"),"undefined"==typeof task.command||task.command instanceof Command||errorList.push("task["+i+"].command must be a Command object"),"undefined"==typeof task.requires&&(task.requires=-1),task.requires instanceof Array||(task.requires=[task.requires]);for(j in task.requires)if(task.requires.hasOwnProperty(j)&&null!=task.requires[j])switch(typeof task.requires[j]){case"string":var gotLabel=!1;for(k=0;!gotLabel&&k<this.tasks.length;k++)task.requires[j]==this.tasks[k].label&&(gotLabel=!0);if(!gotLabel)throw new Error("missing label: "+task.requires[j]);break;case"number":if(task.requires[j]>=this.tasks.length)throw new Error("missing task #"+task.requires[j]+" for requires in task["+i+"]");if(task.requires[j]<-1)throw new Error("task #"+task.requires[j]+" invalid requires in task["+i+"]");break;default:throw new Error("invalid type for requires in task["+i+"]")}}return errorList.length?errorList:null},Request.prototype.toString=function(){switch(this.type){case"Command":return this.type+" Request: "+this.command;default:return this.type+" Request"}};var Store=function(args){if(!1==this instanceof Store)throw new Error("new operator required");args=args||{},this.storeType=args.storeType||"Store",this.name=args.name||"a "+this.storeType,this.storeProperty={isReady:!0,canGetModel:!1,canPutModel:!1,canDeleteModel:!1,canGetList:!1};for(var unusedProperties=T.getInvalidProperties(args,["name","storeType"]),errorList=[],i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Store: multiple errors");if(errorList.length)throw new Error("error creating Store: "+errorList[0])};Store.prototype.toString=function(){return this.name=="a "+this.storeType?this.name:this.storeType+": "+this.name},Store.prototype.getServices=function(){return this.storeProperty},Store.prototype.onConnect=function(location,callBack){if("string"!=typeof location)throw new Error("argument must a url string");if("function"!=typeof callBack)throw new Error("argument must a callback");callBack(this,void 0)},Store.prototype.getModel=function(){throw new Error(this.storeType+" does not provide getModel")},Store.prototype.putModel=function(){throw new Error("Store does not provide putModel")},Store.prototype.deleteModel=function(){throw new Error("Store does not provide deleteModel")},Store.prototype.getList=function(){throw new Error("Store does not provide getList")},Transport.prototype.send=function(message,callBack){var self=this;if("undefined"==typeof message)throw new Error("message required");if(!(message instanceof Message))throw new Error("parameter must be instance of Message");if("undefined"!=typeof callBack&&"function"!=typeof callBack)throw new Error("argument must a callback");return this.connected?void("undefined"!=typeof callBack?self.socket.emit("ackmessage",message,function(msg){callBack.call(self,msg)}):self.socket.send(message)):void callBack.call(self,new Message("Error","not connected"))},Transport.prototype.close=function(){if(!this.connected)throw new Error("not connected");this.socket.disconnect()};var Application=function(args){if(!1==this instanceof Application)throw new Error("new operator required");args=args||{},args.attributes||(args.attributes=[]),args.attributes.push(new Attribute({name:"name",type:"String(20)"})),args.attributes.push(new Attribute({name:"brand",type:"String"})),Model.call(this,args),this.modelType="Application",this.set("name","newApp"),this.set("brand","NEW APP")};Application.prototype=T.inheritPrototype(Model.prototype),Application.prototype.start=function(callBack){if(!1==this.primaryInterface instanceof Interface)throw new Error("error starting application: interface not set");if(!1==this.appPresentation instanceof Presentation)throw new Error("error starting application: appPresentation not set");if(!1==this.toolbarPresentation instanceof Presentation)throw new Error("error starting application: toolbarPresentation not set");if("function"!=typeof callBack)throw new Error("callBack required");var self=this;this.startCallback=callBack,this.primaryInterface.start(self,this.appPresentation,this.toolbarPresentation,function(request){"Command"==request.type?request.command.execute():self.startCallback&&self.startCallback(request)})},Application.prototype.dispatch=function(request,response){if(!1==request instanceof Request)throw new Error("Request required");if(response&&"function"!=typeof response)throw new Error("response callback is not a function");return this.startCallback?(this.startCallback(request),!0):!1},Application.prototype.setInterface=function(primaryInterface){if(!1==primaryInterface instanceof Interface)throw new Error("instance of Interface a required parameter");this.primaryInterface=primaryInterface},Application.prototype.getInterface=function(){return this.primaryInterface},Application.prototype.setAppPresentation=function(appPresentation){if(!1==appPresentation instanceof Presentation)throw new Error("instance of Presentation a required parameter");this.appPresentation=appPresentation,this.startCallback&&this.primaryInterface.setAppPresentation(this.appPresentation)},Application.prototype.getAppPresentation=function(){return this.appPresentation},Application.prototype.setToolbarPresentation=function(toolbarPresentation){if(!1==toolbarPresentation instanceof Presentation)throw new Error("instance of Presentation a required parameter");this.toolbarPresentation=toolbarPresentation,this.startCallback&&this.primaryInterface.setToolbarPresentation(this.toolbarPresentation)},Application.prototype.getToolbarPresentation=function(){return this.toolbarPresentation};var Log=function(args){if(!1==this instanceof Log)throw new Error("new operator required");if("string"==typeof args){var simpleText=args;args={},args.contents=simpleText}args=args||{},args.attributes||(args.attributes=[]);var my_logType=args.logType||"Text",my_importance=args.importance||"Info",my_contents=args.contents||"(no text)";if(!T.contains(T.getLogTypes(),my_logType))throw new Error("Unknown log type: "+my_logType);"undefined"!=typeof args.logType&&delete args.logType,"undefined"!=typeof args.importance&&delete args.importance,"undefined"!=typeof args.contents&&delete args.contents,args.attributes.push(new Attribute({name:"dateLogged",type:"Date",value:new Date})),args.attributes.push(new Attribute({name:"logType",type:"String",value:my_logType})),args.attributes.push(new Attribute({name:"importance",type:"String",value:my_importance})),args.attributes.push("Delta"==my_logType?new Attribute({name:"contents",type:"Object",value:my_contents}):new Attribute({name:"contents",type:"String",value:my_contents})),Model.call(this,args),this.modelType="Log"};Log.prototype=T.inheritPrototype(Model.prototype),Log.prototype.toString=function(){return"Delta"==this.get("logType")?this.get("importance")+": (delta)":this.get("importance")+": "+this.get("contents")};var Presentation=function(args){if(!1==this instanceof Presentation)throw new Error("new operator required");args=args||{},args.attributes||(args.attributes=[]),args.attributes.push(new Attribute({name:"name",type:"String"})),args.attributes.push(new Attribute({name:"modelName",type:"String"})),args.attributes.push(new Attribute({name:"contents",type:"Object",value:[]})),Model.call(this,args),this.modelType="Presentation"};Presentation.prototype=T.inheritPrototype(Model.prototype),Presentation.prototype.getObjectStateErrors=function(modelCheckOnly){var i;if(this.validationErrors=Model.prototype.getObjectStateErrors.call(this),!modelCheckOnly&&0==this.validationErrors.length){var contents=this.get("contents"),gotError=!1;if(contents instanceof Array){for(i=0;i<contents.length;i++)contents[i]instanceof Command||contents[i]instanceof Attribute||"string"==typeof contents[i]||(gotError=!0);gotError&&this.validationErrors.push("contents elements must be Command, Attribute or string")}else this.validationErrors.push("contents must be Array")}return this.validationMessage=this.validationErrors.length>0?this.validationErrors[0]:"",this.validationErrors},Presentation.prototype.validate=function(callBack){function checkAttrib(){checkCount++,this.validationMessage&&(gotError=!0),checkCount==checkCount&&(gotError&&presentation.validationErrors.push("contents has validation errors"),presentation.validationMessage=presentation.validationErrors.length>0?presentation.validationErrors[0]:"",callBack())}var presentation=this;if("function"!=typeof callBack)throw new Error("callback is required");this.getObjectStateErrors();var e;for(e in this._errorConditions)this._errorConditions.hasOwnProperty(e)&&this.validationErrors.push(this._errorConditions[e]);var i,gotError=!1,attributeCount=0,checkCount=0,contents=this.get("contents");if(contents instanceof Array){for(i=0;i<contents.length;i++)contents[i]instanceof Attribute&&attributeCount++;for(i=0;i<contents.length;i++)contents[i]instanceof Attribute&&contents[i].validate(checkAttrib)}};var User=function(args){if(!1==this instanceof User)throw new Error("new operator required");args=args||{},args.attributes||(args.attributes=[]),args.attributes.push(new Attribute({name:"name",type:"String(20)"})),args.attributes.push(new Attribute({name:"active",type:"Boolean"})),args.attributes.push(new Attribute({name:"password",type:"String(20)"})),args.attributes.push(new Attribute({name:"firstName",type:"String(35)"})),args.attributes.push(new Attribute({name:"lastName",type:"String(35)"})),args.attributes.push(new Attribute({name:"email",type:"String(20)"})),Model.call(this,args),this.modelType="User",this.set("active",!1)};User.prototype=T.inheritPrototype(Model.prototype);var Session=function(args){if(!1==this instanceof Session)throw new Error("new operator required");args=args||{},args.attributes||(args.attributes=[]);var userModelID=new Attribute.ModelID(new User);args.attributes.push(new Attribute({name:"userID",type:"Model",value:userModelID})),args.attributes.push(new Attribute({name:"dateStarted",type:"Date",value:new Date})),args.attributes.push(new Attribute({name:"passCode",type:"String(20)"})),args.attributes.push(new Attribute({name:"active",type:"Boolean"})),args.attributes.push(new Attribute({name:"ipAddress",type:"String"})),Model.call(this,args),this.modelType="Session",this.set("active",!1)};Session.prototype=T.inheritPrototype(Model.prototype),Session.prototype.startSession=function(store,userName,password,ip,callBack){if(!1==store instanceof Store)throw new Error("store required");if("string"!=typeof userName)throw new Error("userName required");if("string"!=typeof password)throw new Error("password required");if("string"!=typeof ip)throw new Error("ip required");if("function"!=typeof callBack)throw new Error("callBack required");var self=this,userModel=new User;store.getList(new List(userModel),{name:userName,password:password},function(list,error){if(error)return void callBack(error);if(1!=list.length())return void callBack(new Error("login not found"));for(var passCode="",chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;20>i;i++)passCode+=chars.charAt(Math.floor(Math.random()*chars.length));list.moveFirst(),self.set("userID",list.get("id")),self.set("active",!0),self.set("passCode",passCode),self.set("ipAddress",ip),store.putModel(self,function(model,error){callBack(error,model)})})},Session.prototype.resumeSession=function(store,ip,passCode,callBack){if(!1==store instanceof Store)throw new Error("store required");if("string"!=typeof ip)throw new Error("ip required");if("string"!=typeof passCode)throw new Error("passCode required");if("function"!=typeof callBack)throw new Error("callBack required");var self=this;store.getList(new List(self),{ipAddress:ip,passCode:passCode},function(list,error){return error?void callBack(error):1!=list.length()?void callBack(new Error("session not resumed")):(list.moveFirst(),self.set("id",list.get("id")),self.set("userID",list.get("userID")),self.set("dateStarted",list.get("dateStarted")),self.set("passCode",list.get("passCode")),self.set("active",list.get("active")),self.set("ipAddress",list.get("ipAddress")),void callBack(error,self))})},Session.prototype.endSession=function(store,callBack){if(!1==store instanceof Store)throw new Error("store required");if("function"!=typeof callBack)throw new Error("callBack required");this.get("active")&&this.get("id")||callBack(this),this.set("active",!1),store.putModel(this,function(model,err){callBack(err,model)})},Workspace.prototype=T.inheritPrototype(Model.prototype);var MemoryStore=function(args){if(!1==this instanceof MemoryStore)throw new Error("new operator required");args=args||{},this.storeType=args.storeType||"MemoryStore",this.name=args.name||"a "+this.storeType,this.storeProperty={isReady:!0,canGetModel:!0,canPutModel:!0,canDeleteModel:!0,canGetList:!0},this.data=[],this.idCounter=0;for(var unusedProperties=T.getInvalidProperties(args,["name","storeType"]),errorList=[],i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Store: multiple errors");if(errorList.length)throw new Error("error creating Store: "+errorList[0])};MemoryStore.prototype=T.inheritPrototype(Store.prototype),MemoryStore.prototype.getModel=function(model,callBack){if(!(model instanceof Model))throw new Error("argument must be a Model");if(model.getObjectStateErrors().length)throw new Error("model has validation errors");if(!model.attributes[0].value)throw new Error("ID not set");if("function"!=typeof callBack)throw new Error("callBack required");for(var modelIndex=-1,i=0;i<this.data.length;i++)this.data[i][0]==model.modelType&&(modelIndex=i);if(0>modelIndex)return void callBack(model,new Error("model not found in store"));for(var id=model.get("id"),storedPair=this.data[modelIndex][1],instanceIndex=-1,i=0;0>instanceIndex&&i<storedPair.length;i++)storedPair[i][0]==id&&(instanceIndex=i);if(0>instanceIndex)return void callBack(model,new Error("id not found in store"));var storeValues=storedPair[instanceIndex][1];for(var a in model.attributes)model.attributes[a].value=storeValues[model.attributes[a].name];callBack(model,void 0)},MemoryStore.prototype.putModel=function(model,callBack){if(!(model instanceof Model))throw new Error("argument must be a Model");if(model.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof callBack)throw new Error("callBack required");var id=model.get("ID");if(id){for(var modelIndex=-1,i=0;i<this.data.length;i++)this.data[i][0]==model.modelType&&(modelIndex=i);if(0>modelIndex)return void callBack(model,new Error("model not found in store"));for(var instanceIndex=-1,id=model.get("id"),storedPair=this.data[modelIndex][1],i=0;0>instanceIndex&&i<storedPair.length;i++)storedPair[i][0]==id&&(instanceIndex=i);if(0>instanceIndex)return void callBack(model,new Error("id not found in store"));var ModelValues={};for(var a in model.attributes){var theName=model.attributes[a].name,theValue=model.attributes[a].value;ModelValues[theName]=theValue}storedPair[instanceIndex][1]=ModelValues,callBack(model,void 0)}else{for(var modelIndex=-1,i=0;i<this.data.length;i++)this.data[i][0]==model.modelType&&(modelIndex=i);0>modelIndex&&(this.data.push([model.modelType,[]]),modelIndex=this.data.length-1);var newID=++this.idCounter;model.set("id",newID);var ModelValues={};for(var a in model.attributes){var theName=model.attributes[a].name,theValue=model.attributes[a].value;ModelValues[theName]=theValue}this.data[modelIndex][1].push([newID,ModelValues]),callBack(model,void 0)}},MemoryStore.prototype.deleteModel=function(model,callBack){if(!(model instanceof Model))throw new Error("argument must be a Model");if(model.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof callBack)throw new Error("callBack required");for(var modelIndex=-1,i=0;i<this.data.length;i++)this.data[i][0]==model.modelType&&(modelIndex=i);if(0>modelIndex)return void callBack(model,new Error("model not found in store"));for(var instanceIndex=-1,id=model.get("id"),storedPair=this.data[modelIndex][1],i=0;0>instanceIndex&&i<storedPair.length;i++)storedPair[i][0]==id&&(instanceIndex=i);if(0>instanceIndex)return void callBack(model,new Error("id not found in store"));var storeValues=storedPair.splice(instanceIndex,1)[0][1];for(var a in model.attributes)model.attributes[a].value="id"==model.attributes[a].name?void 0:storeValues[model.attributes[a].name];callBack(model,void 0)},MemoryStore.prototype.getList=function(list,filter,arg3,arg4){var callBack,order;if("function"==typeof arg4?(callBack=arg4,order=arg3):callBack=arg3,!(list instanceof List))throw new Error("argument must be a List");if(!(filter instanceof Object))throw new Error("filter argument must be Object");if("function"!=typeof callBack)throw new Error("callBack required");for(var modelIndex=-1,i=0;i<this.data.length;i++)this.data[i][0]==list.model.modelType&&(modelIndex=i);if(0>modelIndex)return void callBack(list);list.clear();for(var storedPair=this.data[modelIndex][1],i=0;i<storedPair.length;i++){var doIt=!0;for(var prop in filter)filter.hasOwnProperty(prop)&&(filter[prop]instanceof RegExp?filter[prop].test(storedPair[i][1][prop])||(doIt=!1):filter[prop]!=storedPair[i][1][prop]&&(doIt=!1));if(doIt){var dataPart=[];for(var j in storedPair[i][1])dataPart.push(storedPair[i][1][j]);list._items.push(dataPart)}}list._itemIndex=list._items.length-1,order&&list.sort(order),callBack(list)};var MongoStore=function(args){if(!1==this instanceof MongoStore)throw new Error("new operator required");args=args||{},this.storeType=args.storeType||"MongoStore",this.name=args.name||"a "+this.storeType,this.storeProperty={isReady:!1,canGetModel:T.isServer(),canPutModel:T.isServer(),canDeleteModel:T.isServer(),canGetList:T.isServer()};for(var unusedProperties=T.getInvalidProperties(args,["name","storeType"]),errorList=[],i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Store: multiple errors");if(errorList.length)throw new Error("error creating Store: "+errorList[0])};MongoStore.prototype=T.inheritPrototype(Store.prototype),MongoStore.prototype.onConnect=function(location,callBack){if("string"!=typeof location)throw new Error("argument must a url string");if("function"!=typeof callBack)throw new Error("argument must a callback");callBack(this,Error("mongoStore unavailable in client"))};var JSONFileStore=function(args){if(!1==this instanceof JSONFileStore)throw new Error("new operator required");args=args||{},this.storeType=args.storeType||"JSONFileStore",this.name=args.name||"a "+this.storeType,this.storeProperty={isReady:T.isServer(),canGetModel:T.isServer(),canPutModel:T.isServer(),canDeleteModel:T.isServer(),canGetList:T.isServer()},this.data=[],this.idCounter=0;for(var unusedProperties=T.getInvalidProperties(args,["name","storeType"]),errorList=[],i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Store: multiple errors");if(errorList.length)throw new Error("error creating Store: "+errorList[0])};JSONFileStore.prototype=T.inheritPrototype(Store.prototype);var RemoteStore=function(args){if(!1==this instanceof RemoteStore)throw new Error("new operator required");args=args||{},this.storeType=args.storeType||"RemoteStore",this.name=args.name||"a "+this.storeType,this.storeProperty={isReady:!1,canGetModel:!0,canPutModel:!0,canDeleteModel:!0,canGetList:!0};for(var unusedProperties=T.getInvalidProperties(args,["name","storeType"]),errorList=[],i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Store: multiple errors");if(errorList.length)throw new Error("error creating Store: "+errorList[0])};RemoteStore.prototype=T.inheritPrototype(Store.prototype),RemoteStore.prototype.onConnect=function(location,callBack){if("string"!=typeof location)throw new Error("argument must a url string");if("function"!=typeof callBack)throw new Error("argument must a callback");var store=this;try{this.transport=new Transport(location,function(msg){return"Error"==msg.type?(console.log("Transport connect error: "+store.name),void callBack(void 0,new Error(msg.contents))):"Connected"==msg.type?(console.log("Transport connected: "+store.name),store.storeProperty.isReady=!0,void callBack(store)):(console.log("Transport unexpected message type: "+store.name),void callBack(void 0,new Error("unexpected message type: "+msg.type)))})}catch(err){callBack(void 0,err)}},RemoteStore.prototype.putModel=function(model,callBack){if(!(model instanceof Model))throw new Error("argument must be a Model");if(model.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof callBack)throw new Error("callBack required");this.transport.send(new Message("PutModel",model),function(msg){if("PutModelAck"==msg.type){var c=msg.contents;model.attributes=[];for(var a in c.attributes)if(c.attributes.hasOwnProperty(a)){var attrib=new Attribute(c.attributes[a].name,c.attributes[a].type);attrib.value=c.attributes[a].value,model.attributes.push(attrib)}"string"==typeof c?callBack(model,c):callBack(model)}else callBack(model,Error(msg))})},RemoteStore.prototype.getModel=function(model,callBack){if(!(model instanceof Model))throw new Error("argument must be a Model");if(model.getObjectStateErrors().length)throw new Error("model has validation errors");if(!model.attributes[0].value)throw new Error("ID not set");if("function"!=typeof callBack)throw new Error("callBack required");this.transport.send(new Message("GetModel",model),function(msg){if("GetModelAck"==msg.type){var c=msg.contents;model.attributes=[];for(var a in c.attributes)if(c.attributes.hasOwnProperty(a)){var attrib=new Attribute(c.attributes[a].name,c.attributes[a].type);attrib.value=c.attributes[a].value,model.attributes.push(attrib)}"string"==typeof c?callBack(model,c):callBack(model)}else callBack(model,Error(msg))})},RemoteStore.prototype.deleteModel=function(model,callBack){if(!(model instanceof Model))throw new Error("argument must be a Model");if(model.getObjectStateErrors().length)throw new Error("model has validation errors");if("function"!=typeof callBack)throw new Error("callBack required");this.transport.send(new Message("DeleteModel",model),function(msg){if("DeleteModelAck"==msg.type){var c=msg.contents;model.attributes=[];for(var a in c.attributes)if(c.attributes.hasOwnProperty(a)){var attrib=new Attribute(c.attributes[a].name,c.attributes[a].type);attrib.value=c.attributes[a].value,model.attributes.push(attrib)}"string"==typeof c?callBack(model,c):callBack(model)}else callBack(model,Error(msg))})},RemoteStore.prototype.getList=function(list,filter,arg3,arg4){var callBack,order;if("function"==typeof arg4?(callBack=arg4,order=arg3):callBack=arg3,!(list instanceof List))throw new Error("argument must be a List");if(!(filter instanceof Object))throw new Error("filter argument must be Object");if("function"!=typeof callBack)throw new Error("callBack required");this.transport.send(new Message("GetList",{list:list,filter:filter,order:order}),function(msg){"GetListAck"==msg.type?(list._items=msg.contents._items,list._itemIndex=msg.contents._itemIndex,callBack(list)):callBack(list,Error(msg))})},T.setMessageHandler("PutModel",function(messageContents,fn){var ProxyPutModel=function(args){Model.call(this,args),this.modelType=messageContents.modelType,this.attributes=[];for(var a in messageContents.attributes){var attrib=new Attribute(messageContents.attributes[a].name,messageContents.attributes[a].type);"id"==attrib.name?attrib.value!=messageContents.attributes[a].value&&(attrib.value=messageContents.attributes[a].value):attrib.value=messageContents.attributes[a].value,this.attributes.push(attrib)}};ProxyPutModel.prototype=T.inheritPrototype(Model.prototype);var msg,pm=new ProxyPutModel;hostStore.putModel(pm,function(model,error){"undefined"==typeof error?msg=new Message("PutModelAck",model):(console.log("ERROR: "+error),msg=new Message("PutModelAck",error+"")),fn(msg)},this)}),T.setMessageHandler("GetModel",function(messageContents,fn){var ProxyGetModel=function(args){Model.call(this,args),this.modelType=messageContents.modelType,this.attributes=[];for(var a in messageContents.attributes){var attrib=new Attribute(messageContents.attributes[a].name,messageContents.attributes[a].type);attrib.value="id"==attrib.name?messageContents.attributes[a].value:messageContents.attributes[a].value,this.attributes.push(attrib)}};ProxyGetModel.prototype=T.inheritPrototype(Model.prototype);var msg,pm=new ProxyGetModel;hostStore.getModel(pm,function(model,error){msg="undefined"==typeof error?new Message("GetModelAck",model):new Message("GetModelAck",error+""),fn(msg)},this)}),T.setMessageHandler("DeleteModel",function(messageContents,fn){var ProxyDeleteModel=function(args){Model.call(this,args),this.modelType=messageContents.modelType,this.attributes=[];for(var a in messageContents.attributes){var attrib=new Attribute(messageContents.attributes[a].name,messageContents.attributes[a].type);attrib.value="id"==attrib.name?messageContents.attributes[a].value:messageContents.attributes[a].value,this.attributes.push(attrib)}};ProxyDeleteModel.prototype=T.inheritPrototype(Model.prototype);var msg,pm=new ProxyDeleteModel;hostStore.deleteModel(pm,function(model,error){msg="undefined"==typeof error?new Message("DeleteModelAck",model):new Message("DeleteModelAck",error),fn(msg)},this)}),T.setMessageHandler("GetList",function(messageContents,fn){function messageCallback(list,error){msg="undefined"==typeof error?new Message("GetListAck",list):new Message("GetListAck",error),fn(msg)}var proxyList=new List(new Model);proxyList.model.modelType=messageContents.list.model.modelType,proxyList.model.attributes=messageContents.list.model.attributes;var msg;messageContents.order?hostStore.getList(proxyList,messageContents.filter,messageContents.order,messageCallback):hostStore.getList(proxyList,messageContents.filter,messageCallback)});var LocalStore=function(args){if(!1==this instanceof LocalStore)throw new Error("new operator required");args=args||{},this.storeType=args.storeType||"LocalStore",this.name=args.name||"a "+this.storeType;var gotStore="undefined"!=typeof Storage;this.storeProperty={isReady:gotStore,canGetModel:gotStore,canPutModel:gotStore,canDeleteModel:gotStore,canGetList:gotStore},this.data=[],this.idCounter=0,gotStore&&(localStorage.tequilaData=localStorage.tequilaData||[],localStorage.tequilaIDCounter=localStorage.tequilaIDCounter||0,localStorage.tequilaData&&(this.data=JSON.parse(localStorage.tequilaData)),localStorage.tequilaIDCounter&&(this.idCounter=localStorage.tequilaIDCounter));for(var unusedProperties=T.getInvalidProperties(args,["name","storeType"]),errorList=[],i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Store: multiple errors");if(errorList.length)throw new Error("error creating Store: "+errorList[0])};LocalStore.prototype=T.inheritPrototype(Store.prototype);var RedisStore=function(args){if(!1==this instanceof RedisStore)throw new Error("new operator required");args=args||{},this.storeType=args.storeType||"RedisStore",this.name=args.name||"a "+this.storeType,this.storeProperty={isReady:!1,canGetModel:!1,canPutModel:!1,canDeleteModel:!1,canGetList:!1},this.data=[],this.idCounter=0;for(var unusedProperties=T.getInvalidProperties(args,["name","storeType"]),errorList=[],i=0;i<unusedProperties.length;i++)errorList.push("invalid property: "+unusedProperties[i]);if(errorList.length>1)throw new Error("error creating Store: multiple errors");if(errorList.length)throw new Error("error creating Store: "+errorList[0])};RedisStore.prototype=T.inheritPrototype(Store.prototype),Bootstrap3PanelInterface.prototype=T.inheritPrototype(Interface.prototype),Bootstrap3PanelInterface.prototype.start=function(application,presentation,callBack){if(!(application instanceof Application))throw new Error("Application required");if(!(presentation instanceof Presentation))throw new Error("presentation required");if("function"!=typeof callBack)throw new Error("callBack required");throw new Error("Bootstrap3PanelInterface unavailable in server")},Framework7Interface.prototype=T.inheritPrototype(Interface.prototype),Framework7Interface.prototype.start=function(application,presentation,callBack){if(!(application instanceof Application))throw new Error("Application required");if(!(presentation instanceof Presentation))throw new Error("presentation required");if("function"!=typeof callBack)throw new Error("callBack required");throw new Error("Framework7Interface unavailable in server")},MockInterface.prototype=T.inheritPrototype(Interface.prototype),MockInterface.prototype.canMock=function(){return!0};